YUI.add("hermes-template-sub-photo-comments-view",function(t,n){var e=t.Template.Handlebars.revive({1:function(t,n,e,a,l){var o=null!=n?n:{},s=e.helperMissing,r=t.escapeExpression;return"\t<div class='loadingError'>\n\t\t<p>"+r((e.intlMessage||n&&n.intlMessage||s).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.COMMENT_LOADING_ERROR"},data:l}))+'</p>\n\t\t<p><button href="#" class="ui-button ui-button-cta ui-button-transparent retry">'+r((e.intlMessage||n&&n.intlMessage||s).call(o,{name:"intlMessage",hash:{intlName:"common.RETRY"},data:l}))+"</button></p>\n\t</div>\n"},3:function(t,n,e,a,l){var o,s=null!=n?n:{};return"\n\t"+(null!=(o=e.if.call(s,null!=n?n.includePermalink:n,{name:"if",hash:{},fn:t.program(4,l,0),inverse:t.noop,data:l}))?o:"")+'\n\t<div class="comments-holder order-chronological photosInComments '+(null!=(o=e.if.call(s,null!=n?n.enableEmojiPicker:n,{name:"if",hash:{},fn:t.program(6,l,0),inverse:t.noop,data:l}))?o:"")+'">\n'+(null!=(o=e.if.call(s,null!=n?n.showMore:n,{name:"if",hash:{},fn:t.program(8,l,0),inverse:t.noop,data:l}))?o:"")+"\n"+(null!=(o=t.invokePartial(a["sub-photo-comments"],n,{name:"sub-photo-comments",data:l,indent:"\t\t",helpers:e,partials:a,decorators:t.decorators}))?o:"")+"\n"+(null!=(o=e.if.call(s,null!=n?n.canComment:n,{name:"if",hash:{},fn:t.program(19,l,0),inverse:t.program(22,l,0),data:l}))?o:"")+"\n\t</div>\n"},4:function(t,n,e,a,l){return'<a name="comments"></a>'},6:function(t,n,e,a,l){return"with-emoji-picker"},8:function(t,n,e,a,l){var o;return null!=(o=e.if.call(null!=n?n:{},null!=n?n.viewMoreLinkToPhotoPage:n,{name:"if",hash:{},fn:t.program(9,l,0),inverse:t.program(11,l,0),data:l}))?o:""},9:function(t,n,e,a,l){var o,s=null!=n?n:{},r=e.helperMissing,i=t.escapeExpression;return'\t\t\t\t<span class="view-on-photo-page-container">\n\t\t\t\t\t<a href="'+i("function"==typeof(o=null!=(o=e.photoUrl||(null!=n?n.photoUrl:n))?o:r)?o.call(s,{name:"photoUrl",hash:{},data:l}):o)+'#comments">'+i((e.intlMessage||n&&n.intlMessage||r).call(s,{name:"intlMessage",hash:{intlName:"comments.VIEW_ON_PHOTO_PAGE"},data:l}))+"</a>\n\t\t\t\t</span>\n"},11:function(t,n,e,a,l){var o;return"\t\t\t\t<div class='comments-more'>\n"+(null!=(o=e.if.call(null!=n?n:{},null!=n?n.isOnMobile:n,{name:"if",hash:{},fn:t.program(12,l,0),inverse:t.program(14,l,0),data:l}))?o:"")+"\t\t\t\t</div>\n"},12:function(t,n,e,a,l){var o;return'\t\t\t\t\t\t<ul class="lines">\n\t\t\t\t\t\t\t<li class="line">\n\t\t\t\t\t\t\t\t<div class="line-icon">\n\t\t\t\t\t\t\t\t\t<svg class="icon icon-comment"><use xlink:href="#icon-comment"></use></svg>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="line-content">\n\t\t\t\t\t\t\t\t\t<a href=\'#\'>'+t.escapeExpression("function"==typeof(o=null!=(o=e.showMoreString||(null!=n?n.showMoreString:n))?o:e.helperMissing)?o.call(null!=n?n:{},{name:"showMoreString",hash:{},data:l}):o)+"</a>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t</ul>\n"},14:function(t,n,e,a,l){var o;return'\t\t\t\t\t\t<i class="ui-icon-comments"></i>\n'+(null!=(o=e.if.call(null!=n?n:{},null!=n?n.isTooltipComments:n,{name:"if",hash:{},fn:t.program(15,l,0),inverse:t.program(17,l,0),data:l}))?o:"")},15:function(t,n,e,a,l){var o,s=null!=n?n:{},r=e.helperMissing,i=t.escapeExpression;return'\t\t\t\t\t\t\t\t<a href="'+i("function"==typeof(o=null!=(o=e.photoUrl||(null!=n?n.photoUrl:n))?o:r)?o.call(s,{name:"photoUrl",hash:{},data:l}):o)+'" data-action="follow" >'+i("function"==typeof(o=null!=(o=e.showMoreString||(null!=n?n.showMoreString:n))?o:r)?o.call(s,{name:"showMoreString",hash:{},data:l}):o)+"</a>\n"},17:function(t,n,e,a,l){var o;return"\t\t\t\t\t\t\t\t<a href='#'>"+t.escapeExpression("function"==typeof(o=null!=(o=e.showMoreString||(null!=n?n.showMoreString:n))?o:e.helperMissing)?o.call(null!=n?n:{},{name:"showMoreString",hash:{},data:l}):o)+"</a>\n"},19:function(t,n,e,a,l){var o,s=null!=n?n:{};return(null!=(o=t.invokePartial(a["sub-photo-comment-form"],n,{name:"sub-photo-comment-form",data:l,indent:"\t\t\t",helpers:e,partials:a,decorators:t.decorators}))?o:"")+'\n\t\t\t<button class="ui-button ui-button-cta comment" data-action="comment" '+(null!=(o=e.if.call(s,null!=n?n.showCommentButton:n,{name:"if",hash:{},fn:t.program(20,l,0),inverse:t.noop,data:l}))?o:"")+">"+t.escapeExpression((e.intlMessage||n&&n.intlMessage||e.helperMissing).call(s,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.COMMENT"},data:l}))+"</button>\n"},20:function(t,n,e,a,l){return'style="display:block;"'},22:function(t,n,e,a,l){var o;return null!=(o=e.if.call(null!=n?n:{},null!=n?n.isTooltipComments:n,{name:"if",hash:{},fn:t.program(23,l,0),inverse:t.noop,data:l}))?o:""},23:function(t,n,e,a,l){var o;return null!=(o=e.unless.call(null!=n?n:{},null!=(o=null!=n?n.comments:n)?o.length:o,{name:"unless",hash:{},fn:t.program(24,l,0),inverse:t.noop,data:l}))?o:""},24:function(t,n,e,a,l){return'\t\t\t\t<span class="commenting-disabled">'+t.escapeExpression((e.intlMessage||n&&n.intlMessage||e.helperMissing).call(null!=n?n:{},{name:"intlMessage",hash:{intlName:"comments.COMMENTING_DISABLED"},data:l}))+"</span>\n"},compiler:[7,">= 4.0.0"],main:function(t,n,e,a,l){var o;return null!=(o=e.if.call(null!=n?n:{},null!=n?n.loadingError:n,{name:"if",hash:{},fn:t.program(1,l,0),inverse:t.program(3,l,0),data:l}))?o:""},usePartial:!0,useData:!0}),a={};t.Array.each(["sub-photo-comments","sub-photo-comment-form"],function(n){var e=t.Template.get("hermes/"+n);e&&(a[n]=e)}),t.Template.register("hermes/sub-photo-comments-view",function(n,l){return l=l||{},l.partials=l.partials?t.merge(a,l.partials):a,e(n,l)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-sub-photo-comments","hermes-template-sub-photo-comment-form"]});YUI.add("flickr-photos-comments-addComment-creator",function(e,o){"use strict";e.namespace("ModelCreators")["flickr-photos-comments-addComment"]={run:function(t,m){return e.Promise.all([m.callAPI("flickr.photos.comments.addComment",this._processParams(t)),m.getModelRegistry("person-models"),m.getModelRegistry("comment-models")]).then(this._processResponse,e.FetcherErrorLogger(o))},_processParams:function(o){var t={extras:"icon_urls"};return t.photo_id=o.photoId,t.comment_text=o.commentText,t.expand_bbml=!0,t.use_text_for_links=1,t.secure_image_embeds=1,t.bbml_need_all_photo_sizes=!0,t.primary_photo_longest_dimension=e.config.flickr.comment_image_max_width,t},_processResponse:function(o){var t,m,n=o[0],r=o[1],s=o[2];return t={id:n.comment.author,username:n.comment.authorname,pathAlias:n.comment.pathAlias,realname:n.comment.realname,buddyicon:e.APIHelper.response.removeProtocolFromURL(n.comment.iconurls),isPro:n.comment.ispro,proBadge:n.proBadge,isAdFree:n.comment.isAdFree},m=r.exists(n.comment.author)?r.proxy(n.comment.author):r.add(t),s.add({id:n.comment.id,author:m,date:n.comment.datecreate,permalink:n.comment.permalink,content:n.comment.content,contentRaw:n.comment.rawComment.content,contentSecure:n.comment.secureComment.content})}}},"@VERSION@",{requires:["flickr-promise"],optional:[]});YUI.add("flickr-photos-comments-editComment-updater",function(e,t){"use strict";e.namespace("ModelUpdaters")["flickr-photos-comments-editComment"]={run:function(o,n){return e.Promise.all([n.callAPI("flickr.photos.comments.editComment",this._processParams(o)),n.getModel("comment-models",o.commentId)]).then(this._processResponse,e.FetcherErrorLogger(t))},_processParams:function(t){var o;return o={extras:"icon_urls"},o.comment_id=t.commentId,o.comment_text=t.content,o.expand_bbml=!0,o.full_result=1,o.use_text_for_links=1,o.secure_image_embeds=1,o.bbml_need_all_photo_sizes=!0,o.primary_photo_longest_dimension=e.config.flickr.comment_image_max_width,o},_processResponse:function(e){var t=e[0],o=e[1];return o.setValues({content:t.comment.content,contentRaw:t.comment.rawComment.content,contentSecure:t.comment.secureComment.content}),o}}},"@VERSION@",{requires:["flickr-promise"],optional:[]});YUI.add("flickr-photos-comments-deleteComment-deletor",function(e,o){"use strict";e.namespace("ModelDeletors")["flickr-photos-comments-deleteComment"]={run:function(t,r){var n={};return n.comment_id=t,r.callAPI("flickr.photos.comments.deleteComment",n).then(null,e.FetcherErrorLogger(o))}}},"@VERSION@",{requires:["flickr-promise"],optional:[]});YUI.add("comment-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{create:function(t){return e.ModelCreators["flickr-photos-comments-addComment"].run(t,this.appContext)},update:function(t,o){return e.ModelUpdaters["flickr-photos-comments-editComment"].run({commentId:t,content:o.content.newVal},this.appContext)},delete:function(t){return e.ModelDeletors["flickr-photos-comments-deleteComment"].run(t,this.appContext)}},attributes:{author:{isModel:!0},date:{},timeago:{readOnly:!0,derivedBy:["date"],getter:function(t,o){return e.moment.unix(this.getValue(o,"date"))}},permalink:{},content:{},contentSecure:{},contentRaw:{}}})},"@VERSION@",{requires:["flickr-model-registry","moment","flickr-photos-comments-addComment-creator","flickr-photos-comments-editComment-updater","flickr-photos-comments-deleteComment-deletor"]});YUI.add("flickr-photos-comments-getList-fetcher",function(e,t){"use strict";e.namespace("ListFetchers")["flickr-photos-comments-getList"]={run:function(o,s){var r=this;return e.Promise.all([s.callAPI("flickr.photos.comments.getList",this._processParams(o)),s.getModelRegistry("photo-comments-models"),s.getModelRegistry("comment-models"),s.getModelRegistry("person-models")]).then(function(e){return r._processResponse(e,o,s)},e.FetcherErrorLogger(t))},_processParams:function(t){var o,s=void 0!==t.textForPhotoLinks&&t.textForPhotoLinks,r=!!t.page&&!!t.perPage;return o={photo_id:t.id,sort:t.sort||"date-posted-desc",extras:"icon_urls",expand_bbml:1,use_text_for_links:1,secure_image_embeds:1,bbml_need_all_photo_sizes:s?0:1,primary_photo_longest_dimension:e.config.flickr.comment_image_max_width},r?(o.page=t.page,o.per_page=t.perPage):(o.offset=t.offset||0,o.limit=t.limit||4),o},_processResponse:function(t,o,s){var r,n,m,a,i=t[0],c=t[1],d=t[2],p=t[3],l=[];return(void 0===i.comments.comment?0:i.comments.comment.length)>0&&e.Array.each(i.comments.comment,function(t,o,s){(r={id:t.author,username:t.authorname,isDeleted:t.authorIsDeleted,realname:t.realname,pathAlias:t.pathAlias,buddyicon:e.APIHelper.response.removeProtocolFromURL(t.iconurls),isAdFree:t.isAdFree,isPro:t.ispro,proBadge:t.proBadge}).pathAlias=t.pathAlias,m=p.addOrUpdate(r),n={id:t.id,author:m,date:t.datecreate,permalink:t.permalink,content:t.content,contentRaw:t.rawComment.content,contentSecure:t.secureComment.content},l.push(d.addOrUpdate(n))}),c.exists(i.comments.photoId)?(a=c.proxy(i.comments.photoId).getValue("comments").getList().concat(l),c.proxy(i.comments.photoId).setValue("comments",a)):c.add({id:i.comments.photoId,comments:l}),l}}},"@VERSION@",{requires:["flickr-promise"],optional:["photo-comments-models","comment-models","person-models"]});